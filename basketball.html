<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
    <title>Basketball Game</title>
	<script type="text/javascript" src="js/phaser.min.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
				canvas {
					margin: 0 auto;
					border: thin solid black;
				}
    </style>
</head>
<body>

<script type="text/javascript">

var game = new Phaser.Game(640, 1000, Phaser.CANVAS, '', { preload: preload, create: create, update: update });

function preload() {

    game.load.image('ball', 'assets/ball.png');
    game.load.image('hoop', 'assets/hoop.png');
		game.load.image('side rim', 'assets/side_rim.png');
		game.load.image('front rim', 'assets/front_rim.png');

}

var hoop;
var left_rim;
var right_rim;
var ball;
var front_rim;
var current_score = 0;
var current_score_text;
var high_score = 0;
var high_score_text;
var current_best_text;

var collisionGroup;

function create() {

	game.physics.startSystem(Phaser.Physics.P2JS);

  game.physics.p2.restitution = 0.65;
  game.physics.p2.gravity.y = 0;

	collisionGroup = game.physics.p2.createCollisionGroup();

	game.stage.backgroundColor = "#ffffff";

	high_score_text = game.add.text(450, 25, 'High Score\n' + high_score, { font: 'Arial', fontSize: '32px', fill: '#000', align: 'center' });
	current_best_text = game.add.text(230, 450, '', { font: 'Arial', fontSize: '32px', fill: '#000', align: 'center' });
	current_best_score_text = game.add.text(300, 500, '', { font: 'Arial', fontSize: '64px', fill: '#000', align: 'center' });

	hoop = game.add.sprite(141, 100, 'hoop');
	left_rim = game.add.sprite(241, 296, 'side rim');
	right_rim = game.add.sprite(398, 296, 'side rim');

	game.physics.p2.enable([ left_rim, right_rim], false);

	left_rim.body.setCircle(4.5);
	left_rim.body.static = true;
	left_rim.body.setCollisionGroup(collisionGroup);
	left_rim.body.collides([collisionGroup]);

	right_rim.body.setCircle(4.5);
	right_rim.body.static = true;
	right_rim.body.setCollisionGroup(collisionGroup);
	right_rim.body.collides([collisionGroup]);

	createBall();

	cursors = game.input.keyboard.createCursorKeys();

	game.input.onDown.add(launch, this);

}

function update() {

	if (ball && ball.body.velocity.y > 0) {
		front_rim = game.add.sprite(237, 292, 'front rim');
		ball.body.collides([collisionGroup]);
	}

	if (ball && ball.body.velocity.y > 0 && ball.body.y > 300 && !ball.isBelowHoop) {
		ball.isBelowHoop = true;
		ball.body.collideWorldBounds = false;
		if (ball.body.x > 241 && ball.body.x < 398) {
			current_score += 1;
			if (current_score_text) {
				current_score_text.text = current_score;
			} else {
				current_score_text = game.add.text(300, 500, current_score, { font: 'Arial', fontSize: '64px', fill: '#000', align: 'center' });
			}
		} else {
			if (current_score > high_score) {
				high_score = current_score;
				high_score_text.text = 'High Score\n' + high_score;
			}
			current_score = 0;
			current_score_text.text = '';
			current_best_text.text = 'Current Best';
			current_best_score_text.text = high_score;
		}
	}

	if (ball && ball.body.y > 1300) {
		game.physics.p2.gravity.y = 0;
		ball.kill();
		createBall();
	}

	if (cursors.left.isDown)
  {
      ball.body.moveLeft(200);
  }
  else if (cursors.right.isDown)
  {
      ball.body.moveRight(200);
  }

}

function createBall() {

	var xpos;
	if (current_score === 0) {
		xpos = 320;
	} else {
		xpos = 96 + Math.random() * 448;
	}
	ball = game.add.sprite(xpos, 875, 'ball');
	game.physics.p2.enable(ball, false);
	circleshape = ball.body.setCircle(57); // NOTE: Full size is 96
	ball.body.setCollisionGroup(collisionGroup);
	ball.launched = false;
	ball.isBelowHoop = false;

}

function launch() {

	if (ball.launched === false) {
		current_best_text.text = '';
		current_best_score_text.text = '';
		ball.launched = true;
		game.physics.p2.gravity.y = 3300;
		game.add.tween(ball.scale).to({x : 0.6, y : 0.6}, 500, Phaser.Easing.Linear.None, true, 0, 0, false);
		ball.body.velocity.y = -2300;
	}

}

</script>

</body>
</html>
